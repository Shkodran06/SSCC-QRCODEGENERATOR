<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SSCC QR-CODE GENERATOR</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #1e1e1e;
  color: #f0f0f0;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.wrapper {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  max-width: 900px;
  width: 90%;
  background: #2b2b2b;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 3px 15px rgba(0,0,0,0.4);
  justify-content: center;
  align-items: flex-start;
}

.controls {
  flex: 1 1 280px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.input-row {
  display: flex;
  gap: 8px;
  align-items: center;
}

.input-row input {
  flex: 1;
  padding: 10px;
  border-radius: 6px;
  border: none;
  font-size: 1rem;
}

/* X completamente rossa */
.input-row button {
  flex: 0 0 auto;
  padding: 10px;
  font-size: 1.4rem;
  background: #ff0000;
  color: white;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}

.input-row button:hover { background: #cc0000; }

.controls button {
  padding: 8px 12px;
  border-radius: 6px;
  border: none;
  background: #0b5cff;
  color: white;
  cursor: pointer;
  font-size: 0.95rem;
}

.controls button:hover { background: #0736d1; }

.history-title {
  margin-top: 15px;
  font-size: 0.95rem;
  font-weight: bold;
}

.history {
  max-height: 150px;
  overflow-y: auto;
  font-size: 0.9rem;
}

.history-item {
  padding: 4px 0;
  border-bottom: 1px solid #444;
  cursor: pointer;
  user-select: text; /* permette di selezionare e copiare */
}

.history-item:hover { text-decoration: underline; }

.preview-card {
  flex: 1 1 260px;
  background: #f8f8f8;
  color: #000;
  border-radius: 10px;
  padding: 10px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#qrContainer {
  width: 180px;
  height: 180px;
  background: #fff;
  border-radius: 8px;
  border: 1px solid #ccc;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 5px;
}

.qr-placeholder { font-size: 0.85rem; color: #888; text-align: center; }

#last4 { font-size: 1.1rem; font-weight: bold; margin-top: 2px; }

footer {
  width: 100%;
  text-align: center;
  padding: 10px 0;
  position: fixed;
  bottom: 0;
  left: 0;
  font-size: 0.95rem;
  color: #f0f0f0;
  background: #1e1e1e;
}

.night { background: #121212; color: #f0f0f0; }
.night .wrapper { background: #1e1e1e; }
.night .preview-card { background: #2b2b2b; color: #f0f0f0; }
.night .controls button { background: #0b5cff; color: #fff; }
</style>
</head>
<body>

<div class="wrapper">

  <div class="controls">
    <label for="ssccInput">SSCC Nummer</label>
    <div class="input-row">
      <input id="ssccInput" type="text" placeholder="SSCC eingeben oder scannen...">
      <button id="clearBtn" title="L√∂schen">‚úñÔ∏è</button>
    </div>
    <div style="display:flex;gap:8px;">
      <button id="printTestBtn">Drucken</button>
      <button id="downloadBtn">Download</button>
    </div>
    <div class="history-title">Letzte SSCC</div>
    <div class="history" id="historyList"></div>
  </div>

  <div class="preview-card">
    <div id="qrContainer">
      <div class="qr-placeholder">üì± QR wird hier generiert</div>
    </div>
    <div id="last4">----</div>
  </div>

</div>

<footer>
  Made with ‚ù§Ô∏è by Shkodran‚ÄÉüåì Dunkelmodus
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
const ssccInput = document.getElementById('ssccInput');
const clearBtn = document.getElementById('clearBtn');
const qrContainer = document.getElementById('qrContainer');
const last4El = document.getElementById('last4');
const printTestBtn = document.getElementById('printTestBtn');
const downloadBtn = document.getElementById('downloadBtn');
const historyList = document.getElementById('historyList');

let qrCode = null;
let ssccHistory = [];

// Tema scuro al clic sul footer
document.querySelector('footer')?.addEventListener('click', ()=>document.body.classList.toggle('night'));

// Non caricare pi√π la cronologia dal localStorage (parte innovativa sessione)
ssccHistory = [];

// Funzioni cronologia
function addToHistory(sscc){
  if(!sscc) return;
  const now = new Date();
  const time = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
  ssccHistory = ssccHistory.filter(item => item.value !== sscc);
  ssccHistory.unshift({value:sscc, time:time});
  if(ssccHistory.length > 6) ssccHistory.pop();
  renderHistory();
}

function renderHistory(){
  historyList.innerHTML='';
  ssccHistory.forEach(item=>{
    const div = document.createElement('div');
    div.className='history-item';
    div.textContent = `${item.value} (${item.time})`;
    div.addEventListener('click', ()=>{
      ssccInput.value = item.value;
      generateQR(item.value);
      navigator.clipboard.writeText(item.value)
        .then(() => console.log(`SSCC ${item.value} copiato negli appunti`))
        .catch(() => console.log('Copia fallita'));
    });
    historyList.appendChild(div);
  });
}

function generateQR(value){
  qrContainer.innerHTML='';
  last4El.textContent='----';
  if(!value){
    qrContainer.innerHTML='<div class="qr-placeholder">üì± QR wird hier generiert</div>';
    return;
  }
  qrCode=new QRCode(qrContainer,{text:value,width:160,height:160});
  last4El.textContent=value.slice(-4);
  addToHistory(value);
}

function printQR(){
  const img = qrContainer.querySelector('img') || qrContainer.querySelector('canvas');
  if(!img) return alert('QR nicht generiert');
  const qrSrc = img.src || img.toDataURL('image/png');
  const codeText = last4El.textContent || '';
  const printWindow = window.open('','_blank','width=1000,height=1000');
  printWindow.document.write(`
    <html>
      <head>
        <title>Druck QR</title>
        <style>
          @page{size:30mm 30mm;margin:0}
          body{margin:0;padding:0;width:30mm;height:30mm;display:flex;flex-direction:column;justify-content:center;align-items:center;font-family:Arial,sans-serif}
          img{width:24mm;height:24mm}
          .code{font-size:9pt;font-weight:bold;margin-top:1mm}
        </style>
      </head>
      <body>
        <img src="${qrSrc}" alt="QR Code">
        <div class="code">${codeText}</div>
      </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.focus();
  printWindow.print();
  printWindow.close();
}

// Eventi
ssccInput.addEventListener('keydown', e=>{
  if(e.key==='Enter'){
    e.preventDefault();
    const val=ssccInput.value.trim();
    if(val){ generateQR(val); setTimeout(()=>printQR(),300); }
  }
});

clearBtn.addEventListener('click', ()=>{
  ssccInput.value='';
  generateQR('');
});

printTestBtn.addEventListener('click', ()=>printQR());

downloadBtn.addEventListener('click', ()=>{
  if(!qrCode) return alert('QR nicht generiert');
  const img=qrContainer.querySelector('img')||qrContainer.querySelector('canvas');
  if(!img) return alert('QR-Bild nicht verf√ºgbar');
  const link=document.createElement('a');
  link.href=img.src;
  link.download='SSCC_'+ssccInput.value+'.png';
  link.click();
});
</script>

</body>
</html>
